<!DOCTYPE html>
<html>
<head>
    <title>S&P 500 P/E Ratio Predictor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --orange: #fb8b1e;
            --blue: #0068ff;
        }
        body {
            font-family: 'DM Sans', sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        .container {
            background-color: #2d2d2d;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .disclaimer {
            background-color: #3d3d3d;
            border: 1px solid #4d4d4d;
            color: #ffd700;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            font-size: 0.9em;
            line-height: 1.5;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #e0e0e0;
            letter-spacing: 0.02em;
        }
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #4d4d4d;
            border-radius: 4px;
            margin-bottom: 10px;
            background-color: #3d3d3d;
            color: #e0e0e0;
            font-family: 'DM Sans', sans-serif;
        }
        input:focus {
            outline: none;
            border-color: var(--orange);
        }
        button {
            background-color: var(--orange);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'DM Sans', sans-serif;
            font-weight: 500;
            letter-spacing: 0.02em;
        }
        button:hover {
            background-color: #e67d0e;
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            background-color: #3d3d3d;
            border-radius: 4px;
            color: #e0e0e0;
        }
        .chart-container {
            margin-top: 20px;
            height: 600px;
            background-color: #2d2d2d;
            padding: 15px;
            border-radius: 4px;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        h1 {
            color: var(--orange);
            margin-bottom: 20px;
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 0.03em;
            text-transform: uppercase;
        }
        #predictedPE {
            color: var(--blue);
            font-weight: 700;
            font-size: 1.2em;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            .chart-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>S&P 500 P/E Ratio Predictor</h1>
        
        <div class="grid">
            <div>
                <div class="input-group">
                    <label>Current S&P 500 P/E Ratio:</label>
                    <input type="number" id="currentPE" step="0.01" placeholder="Enter current P/E ratio">
                </div>
                <div class="input-group">
                    <label>Expected M2 Money Supply Change (%):</label>
                    <input type="number" id="m2Change" step="0.1" placeholder="Enter expected M2 change">
                </div>
                <div class="input-group">
                    <label>Expected Inflation Rate Change (%):</label>
                    <input type="number" id="inflationChange" step="0.1" placeholder="Enter expected inflation change">
                </div>
                <button onclick="calculatePrediction()">Calculate Prediction</button>
                
                <div class="result" id="predictionResult">
                    <h3>Predicted P/E Ratio: <span id="predictedPE">-</span></h3>
                    <p>Confidence Level: <span id="confidenceLevel">-</span></p>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="historyChart"></canvas>
            </div>
        </div>

        <div class="disclaimer">
            This tool is for informational purposes only and does not constitute financial advice. All predictions are based on historical data and algorithms, and past performance is not indicative of future results. Use at your own risk.
        </div>
    </div>

    <script>
        // Historical data (1960-2023)
        const historicalData = {
            years: [1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023],
            pe: [17.12,18.60,21.25,17.66,18.77,18.75,17.81,15.31,17.71,17.65,15.76,18.12,18.01,18.09,11.68,8.30,11.82,10.41,8.28,7.88,7.39,9.02,7.73,11.48,11.52,10.36,14.28,18.01,14.02,11.82,15.13,15.35,25.93,22.50,21.34,14.89,18.08,19.53,24.29,32.92,29.04,27.55,46.17,31.43,22.73,19.99,18.07,17.36,21.46,70.91,20.70,16.30,14.87,17.03,18.15,20.02,22.18,23.59,24.97,19.60,24.88,35.96,23.11,22.82],
            inflation: [1.46,1.07,1.20,1.24,1.28,1.59,3.02,2.77,4.27,5.46,5.84,4.29,3.27,6.18,11.05,9.14,5.74,6.50,7.63,11.25,13.55,10.33,6.13,3.21,4.30,3.55,1.90,3.66,4.08,4.83,5.40,4.24,3.03,2.95,2.61,2.81,2.93,2.34,1.55,2.19,3.38,2.83,1.59,2.27,2.68,3.39,3.23,2.85,3.84,-0.36,1.64,3.16,2.07,1.46,1.62,0.12,1.26,2.13,2.44,1.81,1.23,4.70,8.00,4.12]
        };

        // Initialize chart with dark theme
        const ctx = document.getElementById('historyChart').getContext('2d');
        Chart.defaults.color = '#e0e0e0';
        Chart.defaults.font.family = "'DM Sans', sans-serif";
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: historicalData.years,
                datasets: [{
                    label: 'Historical P/E Ratio',
                    data: historicalData.pe,
                    borderColor: '#4bc0c0',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: {
                            color: '#3d3d3d'
                        },
                        title: {
                            display: true,
                            text: 'P/E Ratio',
                            color: '#e0e0e0'
                        }
                    },
                    x: {
                        grid: {
                            color: '#3d3d3d'
                        },
                        title: {
                            display: true,
                            text: 'Year',
                            color: '#e0e0e0'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#e0e0e0',
                            font: {
                                family: "'DM Sans', sans-serif"
                            }
                        }
                    }
                }
            }
        });

        function calculatePrediction() {
            const currentPE = parseFloat(document.getElementById('currentPE').value);
            const m2Change = parseFloat(document.getElementById('m2Change').value);
            const inflationChange = parseFloat(document.getElementById('inflationChange').value);
            
            if (isNaN(currentPE) || isNaN(m2Change) || isNaN(inflationChange)) {
                alert('Please enter valid numbers for all fields');
                return;
            }

            // Calculate relative impact based on historical correlations
            const m2Impact = 0.48 * m2Change;
            const inflationImpact = -0.32 * inflationChange;
            
            // Calculate predicted PE using relative changes
            const totalImpactPercent = (m2Impact + inflationImpact) / 100;
            const predictedPE = currentPE * (1 + totalImpactPercent);
            
            // Calculate confidence level based on historical volatility
            const volatility = calculateVolatility(historicalData.pe);
            const confidenceLevel = calculateConfidenceLevel(volatility, Math.abs(totalImpactPercent));
            
            // Display results
            document.getElementById('predictedPE').textContent = predictedPE.toFixed(2);
            document.getElementById('confidenceLevel').textContent = confidenceLevel;
            
            // Update chart with prediction
            const lastYear = Math.max(...historicalData.years);
            updateChartWithPrediction(lastYear + 1, predictedPE);
        }

        function calculateVolatility(data) {
            const returns = [];
            for (let i = 1; i < data.length; i++) {
                returns.push((data[i] - data[i-1]) / data[i-1]);
            }
            return Math.sqrt(returns.reduce((sum, r) => sum + r * r, 0) / returns.length);
        }

        function calculateConfidenceLevel(volatility, impactSize) {
            const confidence = Math.max(0, 1 - (volatility * impactSize * 2));
            if (confidence > 0.8) return "High";
            if (confidence > 0.6) return "Medium";
            return "Low";
        }

        function updateChartWithPrediction(year, pe) {
            const predictionExists = chart.data.datasets.length > 1;
            
            if (predictionExists) {
                chart.data.datasets[1].data = [null, ...historicalData.pe.slice(1), pe];
            } else {
                chart.data.datasets.push({
                    label: 'Predicted P/E',
                    data: Array(historicalData.pe.length).fill(null).concat([pe]),
                    borderColor: '#ff6384',
                    borderDash: [5, 5]
                });
                chart.data.labels = historicalData.years.concat([year]);
            }
            
            chart.update();
        }
    </script>
</body>
</html>
